(()=>{"use strict";var __webpack_modules__={94:(__unused_webpack_module,exports,__webpack_require__)=>{var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.AppController=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),app_service_1=__webpack_require__(3477);let AppController=class AppController{constructor(appService){this.appService=appService}getData(){return this.appService.getData()}};tslib_1.__decorate([(0,common_1.Get)(),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[]),tslib_1.__metadata("design:returntype",void 0)],AppController.prototype,"getData",null),AppController=tslib_1.__decorate([(0,common_1.Controller)(),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==app_service_1.AppService&&app_service_1.AppService)?_a:Object])],AppController),exports.AppController=AppController},8753:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.AppModule=void 0;const tslib_1=__webpack_require__(752),auth_module_1=__webpack_require__(362),common_1=__webpack_require__(6481),mongoose_1=__webpack_require__(1794),core_1=__webpack_require__(143),community_module_1=__webpack_require__(908),thread_module_1=__webpack_require__(2664),environment_prod_1=__webpack_require__(6087),app_controller_1=__webpack_require__(94),app_service_1=__webpack_require__(3477),jwt_auth_guard_1=__webpack_require__(3982),roles_guard_1=__webpack_require__(1746),category_module_1=__webpack_require__(7237),message_module_1=__webpack_require__(527),neo4j_module_1=__webpack_require__(7641),user_module_1=__webpack_require__(6642);let AppModule=class AppModule{};AppModule=tslib_1.__decorate([(0,common_1.Module)({imports:[mongoose_1.MongooseModule.forRoot(environment_prod_1.environment.DATABASE_CONNECTION),neo4j_module_1.Neo4jModule.forRoot({scheme:"bolt",host:"127.0.0.1",port:7687,username:"neo4j",password:"neo"}),community_module_1.CommunityModule,thread_module_1.ThreadModule,user_module_1.UserModule,auth_module_1.AuthModule,category_module_1.CategoryModule,message_module_1.MessageModule],controllers:[app_controller_1.AppController],providers:[{provide:core_1.APP_GUARD,useClass:jwt_auth_guard_1.JwtAuthGuard},{provide:core_1.APP_GUARD,useClass:roles_guard_1.RolesGuard},app_service_1.AppService]})],AppModule),exports.AppModule=AppModule},3477:(__unused_webpack_module,exports,__webpack_require__)=>{var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.AppService=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),neo4j_service_1=__webpack_require__(857);let AppService=class AppService{constructor(neo4jService){this.neo4jService=neo4jService}getData(){return{message:"Welcome to riddet-api!"}}};AppService=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==neo4j_service_1.Neo4jService&&neo4j_service_1.Neo4jService)?_a:Object])],AppService),exports.AppService=AppService},7410:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b;Object.defineProperty(exports,"__esModule",{value:!0}),exports.AuthController=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),passport_1=__webpack_require__(4340),user_dto_1=__webpack_require__(7513),auth_module_1=__webpack_require__(362),auth_service_1=__webpack_require__(1378),role_enum_1=__webpack_require__(1360);let AuthController=class AuthController{constructor(authService){this.authService=authService}login(req){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return this.authService.login(req.body)}))}register(CreateUserDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return this.authService.register(CreateUserDto)}))}getProfile(req){return req.user}};tslib_1.__decorate([(0,auth_module_1.Public)(),(0,common_1.UseGuards)((0,passport_1.AuthGuard)("local")),(0,common_1.Post)("auth/login"),tslib_1.__param(0,(0,common_1.Request)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[Object]),tslib_1.__metadata("design:returntype",Promise)],AuthController.prototype,"login",null),tslib_1.__decorate([(0,auth_module_1.Public)(),(0,common_1.Post)("auth/register"),tslib_1.__param(0,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",["function"==typeof(_b=void 0!==user_dto_1.CreateUserDto&&user_dto_1.CreateUserDto)?_b:Object]),tslib_1.__metadata("design:returntype",Promise)],AuthController.prototype,"register",null),tslib_1.__decorate([(0,auth_module_1.Roles)(role_enum_1.Role.User),(0,common_1.Get)("profile"),tslib_1.__param(0,(0,common_1.Request)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[Object]),tslib_1.__metadata("design:returntype",void 0)],AuthController.prototype,"getProfile",null),AuthController=tslib_1.__decorate([(0,common_1.Controller)(),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==auth_service_1.AuthService&&auth_service_1.AuthService)?_a:Object])],AuthController),exports.AuthController=AuthController},362:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.AuthModule=exports.Roles=exports.ROLES_KEY=exports.Public=exports.IS_PUBLIC_KEY=void 0;const tslib_1=__webpack_require__(752);exports.IS_PUBLIC_KEY="isPublic";exports.Public=()=>(0,common_1.SetMetadata)(exports.IS_PUBLIC_KEY,!0),exports.ROLES_KEY="roles";exports.Roles=(...roles)=>(0,common_1.SetMetadata)(exports.ROLES_KEY,roles);const common_1=__webpack_require__(6481),jwt_1=__webpack_require__(2064),passport_1=__webpack_require__(4340),user_module_1=__webpack_require__(6642),auth_controller_1=__webpack_require__(7410),auth_service_1=__webpack_require__(1378),constants_1=__webpack_require__(3143),jwt_strategy_1=__webpack_require__(1981),local_strategy_1=__webpack_require__(9808);let AuthModule=class AuthModule{};AuthModule=tslib_1.__decorate([(0,common_1.Module)({imports:[user_module_1.UserModule,passport_1.PassportModule,jwt_1.JwtModule.register({secret:constants_1.jwtConstants.secret,signOptions:{expiresIn:"2d"}})],providers:[auth_service_1.AuthService,local_strategy_1.LocalStrategy,jwt_strategy_1.JwtStrategy],exports:[auth_service_1.AuthService],controllers:[auth_controller_1.AuthController]})],AuthModule),exports.AuthModule=AuthModule},1378:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b;Object.defineProperty(exports,"__esModule",{value:!0}),exports.AuthService=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),jwt_1=__webpack_require__(2064),bcrypt=__webpack_require__(8432),user_service_1=__webpack_require__(5680);let AuthService=class AuthService{constructor(userService,jwtService){this.userService=userService,this.jwtService=jwtService}validateUser(username,pass){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const user=yield this.userService.findByUsernameOrEmail(username);if(user&&(yield bcrypt.compareSync(pass,user.password)))return user;throw new common_1.HttpException("Incorrect credentials!",common_1.HttpStatus.BAD_REQUEST)}))}register(createUserDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const user=yield this.userService.create(createUserDto);return this.login(user)}))}login(user){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const payload={username:user.username},loggedInUser=yield this.userService.findByUsernameOrEmail(user.username);return{_id:loggedInUser._id,username:loggedInUser.username,firstname:loggedInUser.firstname,lastname:loggedInUser.lastname,email:loggedInUser.email,roles:loggedInUser.roles,userImageUrl:loggedInUser.userImageUrl,access_token:this.jwtService.sign(payload)}}))}};AuthService=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==user_service_1.UserService&&user_service_1.UserService)?_a:Object,"function"==typeof(_b=void 0!==jwt_1.JwtService&&jwt_1.JwtService)?_b:Object])],AuthService),exports.AuthService=AuthService},3143:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.jwtConstants=void 0,exports.jwtConstants={secret:"secretKey"}},3982:(__unused_webpack_module,exports,__webpack_require__)=>{var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.JwtAuthGuard=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),core_1=__webpack_require__(143),passport_1=__webpack_require__(4340),auth_module_1=__webpack_require__(362);let JwtAuthGuard=class JwtAuthGuard extends((0,passport_1.AuthGuard)("jwt")){constructor(reflector){super(),this.reflector=reflector}canActivate(context){return!!this.reflector.getAllAndOverride(auth_module_1.IS_PUBLIC_KEY,[context.getHandler(),context.getClass()])||super.canActivate(context)}};JwtAuthGuard=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==core_1.Reflector&&core_1.Reflector)?_a:Object])],JwtAuthGuard),exports.JwtAuthGuard=JwtAuthGuard},1981:(__unused_webpack_module,exports,__webpack_require__)=>{var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.JwtStrategy=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),passport_1=__webpack_require__(4340),passport_jwt_1=__webpack_require__(136),user_service_1=__webpack_require__(5680),constants_1=__webpack_require__(3143);let JwtStrategy=class JwtStrategy extends((0,passport_1.PassportStrategy)(passport_jwt_1.Strategy)){constructor(userService){super({jwtFromRequest:passport_jwt_1.ExtractJwt.fromAuthHeaderAsBearerToken(),ignoreExpiration:!1,secretOrKey:constants_1.jwtConstants.secret}),this.userService=userService}validate(payload){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const user=yield this.userService.findByUsernameOrEmail(payload.username);if(user)return{id:user._id,username:payload.username,email:user.email,name:user.firstname+" "+user.lastname,roles:user.roles};throw new common_1.HttpException("Login has expired!",common_1.HttpStatus.UNAUTHORIZED)}))}};JwtStrategy=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==user_service_1.UserService&&user_service_1.UserService)?_a:Object])],JwtStrategy),exports.JwtStrategy=JwtStrategy},9808:(__unused_webpack_module,exports,__webpack_require__)=>{var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.LocalStrategy=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),passport_1=__webpack_require__(4340),passport_local_1=__webpack_require__(7055),auth_service_1=__webpack_require__(1378);let LocalStrategy=class LocalStrategy extends((0,passport_1.PassportStrategy)(passport_local_1.Strategy)){constructor(authService){super(),this.authService=authService}validate(username,password){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const user=yield this.authService.validateUser(username,password);if(!user)throw new common_1.HttpException("No user found with current username or email!",common_1.HttpStatus.NOT_FOUND);return user}))}};LocalStrategy=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==auth_service_1.AuthService&&auth_service_1.AuthService)?_a:Object])],LocalStrategy),exports.LocalStrategy=LocalStrategy},1360:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.Role=void 0,function(Role){Role.User="user",Role.Admin="admin"}(exports.Role||(exports.Role={}))},1746:(__unused_webpack_module,exports,__webpack_require__)=>{var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.RolesGuard=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),core_1=__webpack_require__(143),auth_module_1=__webpack_require__(362);let RolesGuard=class RolesGuard{constructor(reflector){this.reflector=reflector}canActivate(context){const requiredRoles=this.reflector.getAllAndOverride(auth_module_1.ROLES_KEY,[context.getHandler(),context.getClass()]);if(!requiredRoles)return!0;const{user}=context.switchToHttp().getRequest();return requiredRoles.some((role=>{var _a;return null===(_a=user.roles)||void 0===_a?void 0:_a.includes(role)}))}};RolesGuard=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==core_1.Reflector&&core_1.Reflector)?_a:Object])],RolesGuard),exports.RolesGuard=RolesGuard},1363:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b,_c,_d,_e,_f;Object.defineProperty(exports,"__esModule",{value:!0}),exports.CommunitiesController=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),auth_module_1=__webpack_require__(362),role_enum_1=__webpack_require__(1360),ParseObjectIdPipe_1=__webpack_require__(2840),category_dto_1=__webpack_require__(322),category_service_1=__webpack_require__(9759);let CommunitiesController=class CommunitiesController{constructor(categoryService){this.categoryService=categoryService}getById(id){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log(`Getting category with id: ${id} (READ)`),yield this.categoryService.getById(id)}))}getAll(){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log("Getting all categories (READ)"),this.categoryService.getAll()}))}create(categoryDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log("Creating category (CREATE)"),this.categoryService.create(categoryDto)}))}delete(id){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log(`Getting category with id: ${id} (DELETE)`),this.categoryService.delete(id)}))}};tslib_1.__decorate([(0,common_1.Get)(":id"),tslib_1.__param(0,(0,common_1.Param)("id",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String]),tslib_1.__metadata("design:returntype","function"==typeof(_b="undefined"!=typeof Promise&&Promise)?_b:Object)],CommunitiesController.prototype,"getById",null),tslib_1.__decorate([(0,common_1.Get)(),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[]),tslib_1.__metadata("design:returntype","function"==typeof(_c="undefined"!=typeof Promise&&Promise)?_c:Object)],CommunitiesController.prototype,"getAll",null),tslib_1.__decorate([(0,auth_module_1.Roles)(role_enum_1.Role.Admin),(0,common_1.Post)(),tslib_1.__param(0,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",["function"==typeof(_d=void 0!==category_dto_1.CategoryDto&&category_dto_1.CategoryDto)?_d:Object]),tslib_1.__metadata("design:returntype","function"==typeof(_e="undefined"!=typeof Promise&&Promise)?_e:Object)],CommunitiesController.prototype,"create",null),tslib_1.__decorate([(0,auth_module_1.Roles)(role_enum_1.Role.Admin),(0,common_1.Delete)(":id"),tslib_1.__param(0,(0,common_1.Param)("id",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String]),tslib_1.__metadata("design:returntype","function"==typeof(_f="undefined"!=typeof Promise&&Promise)?_f:Object)],CommunitiesController.prototype,"delete",null),CommunitiesController=tslib_1.__decorate([(0,common_1.Controller)("categories"),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==category_service_1.CategoryService&&category_service_1.CategoryService)?_a:Object])],CommunitiesController),exports.CommunitiesController=CommunitiesController},322:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.CategoryDto=void 0;const tslib_1=__webpack_require__(752),class_validator_1=__webpack_require__(5849);class CategoryDto{}tslib_1.__decorate([(0,class_validator_1.IsString)({message:"Name must be a string!"}),(0,class_validator_1.IsDefined)({message:"Name is required!"}),(0,class_validator_1.IsNotEmpty)({message:"Name cannot be empty!"}),tslib_1.__metadata("design:type",String)],CategoryDto.prototype,"name",void 0),exports.CategoryDto=CategoryDto},7237:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.CategoryModule=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),mongoose_1=__webpack_require__(1794),category_controller_1=__webpack_require__(1363),category_schema_1=__webpack_require__(8812),category_service_1=__webpack_require__(9759);let CategoryModule=class CategoryModule{};CategoryModule=tslib_1.__decorate([(0,common_1.Module)({imports:[mongoose_1.MongooseModule.forFeature([{name:category_schema_1.Category.name,schema:category_schema_1.CategorySchema}])],controllers:[category_controller_1.CommunitiesController],providers:[category_service_1.CategoryService],exports:[category_service_1.CategoryService]})],CategoryModule),exports.CategoryModule=CategoryModule},8812:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.CategorySchema=exports.Category=void 0;const tslib_1=__webpack_require__(752),mongoose_1=__webpack_require__(1794),class_validator_1=__webpack_require__(5849);let Category=class Category{};tslib_1.__decorate([(0,class_validator_1.IsString)({message:"Name must be a string!"}),(0,class_validator_1.IsDefined)({message:"Name is required!"}),(0,class_validator_1.IsNotEmpty)({message:"Name cannot be empty!"}),(0,mongoose_1.Prop)(),tslib_1.__metadata("design:type",String)],Category.prototype,"name",void 0),Category=tslib_1.__decorate([(0,mongoose_1.Schema)()],Category),exports.Category=Category,exports.CategorySchema=mongoose_1.SchemaFactory.createForClass(Category)},9759:(__unused_webpack_module,exports,__webpack_require__)=>{var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.CategoryService=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),mongoose_1=__webpack_require__(1794),mongoose_2=__webpack_require__(1185),category_schema_1=__webpack_require__(8812);let CategoryService=class CategoryService{constructor(categoryModel){this.categoryModel=categoryModel}getById(_id){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.doesExist(_id),this.categoryModel.findOne({_id})}))}getAll(){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return this.categoryModel.find({})}))}create(categoryDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.validate(void 0,categoryDto.name),this.categoryModel.create(categoryDto)}))}delete(_id){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.doesExist(_id),this.categoryModel.findOneAndDelete({_id})}))}validate(id,name){return tslib_1.__awaiter(this,void 0,void 0,(function*(){if((yield this.categoryModel.find({$and:[{_id:{$ne:id}},{name}]}).countDocuments())>0)throw new common_1.HttpException(`Category with name of ${name} already exists!`,common_1.HttpStatus.BAD_REQUEST)}))}doesExist(id){return tslib_1.__awaiter(this,void 0,void 0,(function*(){if(!(yield this.categoryModel.findOne({_id:id})))throw new common_1.HttpException(`Category with id of ${id} doesn't exist!`,common_1.HttpStatus.BAD_REQUEST)}))}};CategoryService=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__param(0,(0,mongoose_1.InjectModel)(category_schema_1.Category.name)),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==mongoose_2.Model&&mongoose_2.Model)?_a:Object])],CategoryService),exports.CategoryService=CategoryService},6794:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b,_c,_d,_e,_f,_g,_h,_j,_k,_l,_m;Object.defineProperty(exports,"__esModule",{value:!0}),exports.CommunitiesController=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),auth_module_1=__webpack_require__(362),ParseObjectIdPipe_1=__webpack_require__(2840),community_dto_1=__webpack_require__(9657),community_service_1=__webpack_require__(8367);let CommunitiesController=class CommunitiesController{constructor(communityService){this.communityService=communityService}getAll(){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log("Getting all communities (READ)"),this.communityService.getAll()}))}getAllJoinedCommunities(req){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log("Getting all communities user has joined (READ)"),this.communityService.getAllJoinedCommunities(req)}))}getAllCreatedCommunities(req){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log("Getting all communities user has created (READ)"),this.communityService.getAllCreatedCommunities(req)}))}getById(id){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log(`Getting community with id: ${id} (READ)`),yield this.communityService.getById(id)}))}create(createCommunityDto,req){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log("Creating community (CREATE)"),this.communityService.create(createCommunityDto,req)}))}update(id,req,updateCommunityDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log(`Getting community with id: ${id} (UPDATE)`),this.communityService.update(id,updateCommunityDto,req)}))}delete(id,req){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log(`Getting community with id: ${id} (DELETE)`),this.communityService.delete(id,req)}))}join(id,req){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log(`Getting community with id: ${id} (DELETE)`),this.communityService.join(id,req)}))}leave(id,req){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log(`Getting community with id: ${id} (DELETE)`),this.communityService.leave(id,req)}))}};tslib_1.__decorate([(0,auth_module_1.Public)(),(0,common_1.Get)(),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[]),tslib_1.__metadata("design:returntype","function"==typeof(_b="undefined"!=typeof Promise&&Promise)?_b:Object)],CommunitiesController.prototype,"getAll",null),tslib_1.__decorate([(0,common_1.Get)("/joined"),tslib_1.__param(0,(0,common_1.Req)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[Object]),tslib_1.__metadata("design:returntype","function"==typeof(_c="undefined"!=typeof Promise&&Promise)?_c:Object)],CommunitiesController.prototype,"getAllJoinedCommunities",null),tslib_1.__decorate([(0,common_1.Get)("/created"),tslib_1.__param(0,(0,common_1.Req)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[Object]),tslib_1.__metadata("design:returntype","function"==typeof(_d="undefined"!=typeof Promise&&Promise)?_d:Object)],CommunitiesController.prototype,"getAllCreatedCommunities",null),tslib_1.__decorate([(0,auth_module_1.Public)(),(0,common_1.Get)(":id"),tslib_1.__param(0,(0,common_1.Param)("id",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String]),tslib_1.__metadata("design:returntype","function"==typeof(_e="undefined"!=typeof Promise&&Promise)?_e:Object)],CommunitiesController.prototype,"getById",null),tslib_1.__decorate([(0,common_1.Post)(),tslib_1.__param(0,(0,common_1.Body)()),tslib_1.__param(1,(0,common_1.Req)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",["function"==typeof(_f=void 0!==community_dto_1.CreateCommunityDto&&community_dto_1.CreateCommunityDto)?_f:Object,Object]),tslib_1.__metadata("design:returntype","function"==typeof(_g="undefined"!=typeof Promise&&Promise)?_g:Object)],CommunitiesController.prototype,"create",null),tslib_1.__decorate([(0,common_1.Patch)(":id"),tslib_1.__param(0,(0,common_1.Param)("id",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__param(1,(0,common_1.Req)()),tslib_1.__param(2,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,Object,"function"==typeof(_h=void 0!==community_dto_1.UpdateCommunityDto&&community_dto_1.UpdateCommunityDto)?_h:Object]),tslib_1.__metadata("design:returntype","function"==typeof(_j="undefined"!=typeof Promise&&Promise)?_j:Object)],CommunitiesController.prototype,"update",null),tslib_1.__decorate([(0,common_1.Delete)(":id"),tslib_1.__param(0,(0,common_1.Param)("id",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__param(1,(0,common_1.Req)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,Object]),tslib_1.__metadata("design:returntype","function"==typeof(_k="undefined"!=typeof Promise&&Promise)?_k:Object)],CommunitiesController.prototype,"delete",null),tslib_1.__decorate([(0,common_1.Post)(":id/join"),tslib_1.__param(0,(0,common_1.Param)("id",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__param(1,(0,common_1.Req)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,Object]),tslib_1.__metadata("design:returntype","function"==typeof(_l="undefined"!=typeof Promise&&Promise)?_l:Object)],CommunitiesController.prototype,"join",null),tslib_1.__decorate([(0,common_1.Post)(":id/leave"),tslib_1.__param(0,(0,common_1.Param)("id",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__param(1,(0,common_1.Req)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,Object]),tslib_1.__metadata("design:returntype","function"==typeof(_m="undefined"!=typeof Promise&&Promise)?_m:Object)],CommunitiesController.prototype,"leave",null),CommunitiesController=tslib_1.__decorate([(0,common_1.Controller)("communities"),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==community_service_1.CommunityService&&community_service_1.CommunityService)?_a:Object])],CommunitiesController),exports.CommunitiesController=CommunitiesController},9657:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.UpdateCommunityDto=exports.CreateCommunityDto=void 0;const tslib_1=__webpack_require__(752),class_validator_1=__webpack_require__(5849);class CreateCommunityDto{}tslib_1.__decorate([(0,class_validator_1.IsString)({message:"Name must be a string!"}),(0,class_validator_1.IsDefined)({message:"Name is required!"}),(0,class_validator_1.MinLength)(5,{message:"Name must be at least 5 characters long!"}),tslib_1.__metadata("design:type",String)],CreateCommunityDto.prototype,"name",void 0),tslib_1.__decorate([(0,class_validator_1.IsString)({message:"Description must be a string!"}),(0,class_validator_1.IsDefined)({message:"Description is required!"}),(0,class_validator_1.IsNotEmpty)({message:"Description cannot be empty!"}),tslib_1.__metadata("design:type",String)],CreateCommunityDto.prototype,"description",void 0),tslib_1.__decorate([(0,class_validator_1.IsString)({message:"ImageUrl must be a string!"}),(0,class_validator_1.IsDefined)({message:"ImageUrl is required!"}),(0,class_validator_1.IsNotEmpty)({message:"ImageUrl cannot be empty!"}),tslib_1.__metadata("design:type",String)],CreateCommunityDto.prototype,"imageUrl",void 0),tslib_1.__decorate([(0,class_validator_1.IsBoolean)({message:"isPublic must be a boolean!"}),(0,class_validator_1.IsDefined)({message:"isPublic is required!"}),(0,class_validator_1.IsNotEmpty)({message:"isPublic cannot be empty!"}),tslib_1.__metadata("design:type",Boolean)],CreateCommunityDto.prototype,"isPublic",void 0),tslib_1.__decorate([(0,class_validator_1.ArrayNotEmpty)({message:"Categories cannot be empty!"}),(0,class_validator_1.IsDefined)({message:"Categories are required!"}),tslib_1.__metadata("design:type",Array)],CreateCommunityDto.prototype,"categories",void 0),exports.CreateCommunityDto=CreateCommunityDto;class UpdateCommunityDto{}tslib_1.__decorate([(0,class_validator_1.IsOptional)(),(0,class_validator_1.IsString)({message:"Name must be a string!"}),(0,class_validator_1.IsDefined)({message:"Name is required!"}),(0,class_validator_1.MinLength)(5,{message:"Name must be at least 5 characters long!"}),tslib_1.__metadata("design:type",String)],UpdateCommunityDto.prototype,"name",void 0),tslib_1.__decorate([(0,class_validator_1.IsOptional)(),(0,class_validator_1.IsString)({message:"Description must be a string!"}),(0,class_validator_1.IsDefined)({message:"Description is required!"}),(0,class_validator_1.IsNotEmpty)({message:"Description cannot be empty!"}),tslib_1.__metadata("design:type",String)],UpdateCommunityDto.prototype,"description",void 0),tslib_1.__decorate([(0,class_validator_1.IsOptional)(),(0,class_validator_1.IsString)({message:"ImageUrl must be a string!"}),(0,class_validator_1.IsDefined)({message:"ImageUrl is required!"}),(0,class_validator_1.IsNotEmpty)({message:"ImageUrl cannot be empty!"}),tslib_1.__metadata("design:type",String)],UpdateCommunityDto.prototype,"imageUrl",void 0),tslib_1.__decorate([(0,class_validator_1.IsOptional)(),(0,class_validator_1.IsBoolean)({message:"isPublic must be a boolean!"}),(0,class_validator_1.IsNotEmpty)({message:"isPublic cannot be empty!"}),tslib_1.__metadata("design:type",Boolean)],UpdateCommunityDto.prototype,"isPublic",void 0),tslib_1.__decorate([(0,class_validator_1.IsOptional)(),(0,class_validator_1.ArrayNotEmpty)({message:"Categories cannot be empty!"}),(0,class_validator_1.IsNotEmpty)({message:"Categories cannot be empty!"}),tslib_1.__metadata("design:type",Array)],UpdateCommunityDto.prototype,"categories",void 0),exports.UpdateCommunityDto=UpdateCommunityDto},908:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.CommunityModule=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),mongoose_1=__webpack_require__(1794),category_module_1=__webpack_require__(7237),user_module_1=__webpack_require__(6642),community_controller_1=__webpack_require__(6794),community_schema_1=__webpack_require__(637),community_service_1=__webpack_require__(8367);let CommunityModule=class CommunityModule{};CommunityModule=tslib_1.__decorate([(0,common_1.Module)({imports:[mongoose_1.MongooseModule.forFeature([{name:community_schema_1.Community.name,schema:community_schema_1.CommunitySchema}]),(0,common_1.forwardRef)((()=>category_module_1.CategoryModule)),(0,common_1.forwardRef)((()=>user_module_1.UserModule))],controllers:[community_controller_1.CommunitiesController],providers:[community_service_1.CommunityService],exports:[community_service_1.CommunityService,mongoose_1.MongooseModule]})],CommunityModule),exports.CommunityModule=CommunityModule},637:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b;Object.defineProperty(exports,"__esModule",{value:!0}),exports.CommunitySchema=exports.Community=void 0;const tslib_1=__webpack_require__(752),mongoose_1=__webpack_require__(1794),class_validator_1=__webpack_require__(5849),user_schema_1=__webpack_require__(8427);let Community=class Community{};tslib_1.__decorate([(0,class_validator_1.IsString)({message:"Name must be a string!"}),(0,class_validator_1.IsDefined)({message:"Name is required!"}),(0,class_validator_1.MinLength)(5,{message:"Name must be at least 5 characters long!"}),(0,mongoose_1.Prop)({unique:!0}),tslib_1.__metadata("design:type",String)],Community.prototype,"name",void 0),tslib_1.__decorate([(0,class_validator_1.IsString)({message:"Description must be a string!"}),(0,class_validator_1.IsDefined)({message:"Description is required!"}),(0,class_validator_1.IsNotEmpty)({message:"Description cannot be empty!"}),(0,mongoose_1.Prop)(),tslib_1.__metadata("design:type",String)],Community.prototype,"description",void 0),tslib_1.__decorate([(0,class_validator_1.IsDate)({message:"Creation date must be a date!"}),(0,mongoose_1.Prop)(),tslib_1.__metadata("design:type","function"==typeof(_a="undefined"!=typeof Date&&Date)?_a:Object)],Community.prototype,"creationDate",void 0),tslib_1.__decorate([(0,class_validator_1.IsString)({message:"Image must be a string!"}),(0,mongoose_1.Prop)(),tslib_1.__metadata("design:type",String)],Community.prototype,"imageUrl",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)(),tslib_1.__metadata("design:type",Boolean)],Community.prototype,"isPublic",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)({default:[]}),tslib_1.__metadata("design:type",Array)],Community.prototype,"categories",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)({default:[],ref:"User"}),tslib_1.__metadata("design:type",Array)],Community.prototype,"participants",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)({default:[]}),tslib_1.__metadata("design:type",Array)],Community.prototype,"threads",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)(),tslib_1.__metadata("design:type","function"==typeof(_b=void 0!==user_schema_1.User&&user_schema_1.User)?_b:Object)],Community.prototype,"createdBy",void 0),Community=tslib_1.__decorate([(0,mongoose_1.Schema)()],Community),exports.Community=Community,exports.CommunitySchema=mongoose_1.SchemaFactory.createForClass(Community)},8367:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b,_c;Object.defineProperty(exports,"__esModule",{value:!0}),exports.CommunityService=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),mongoose_1=__webpack_require__(1794),mongoose_2=__webpack_require__(1185),role_enum_1=__webpack_require__(1360),category_service_1=__webpack_require__(9759),ParseObjectIdPipe_1=__webpack_require__(2840),user_service_1=__webpack_require__(5680),community_schema_1=__webpack_require__(637);let CommunityService=class CommunityService{constructor(communityModel,categoryService,userService){this.communityModel=communityModel,this.categoryService=categoryService,this.userService=userService}getById(_id){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.doesExist(_id),yield this.communityModel.findOne({_id})}))}getAll(){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.communityModel.find({})}))}getAllJoinedCommunities(req){var e_1,_a;return tslib_1.__awaiter(this,void 0,void 0,(function*(){const joinedCommunities=[],user=yield this.userService.getById(req.user.id);try{for(var _c,_b=tslib_1.__asyncValues(user.joinedCommunities);!(_c=yield _b.next()).done;){const communityId=_c.value;joinedCommunities.push(yield this.getById(communityId.toString()))}}catch(e_1_1){e_1={error:e_1_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&(yield _a.call(_b))}finally{if(e_1)throw e_1.error}}return joinedCommunities}))}getAllCreatedCommunities(req){var e_2,_a;return tslib_1.__awaiter(this,void 0,void 0,(function*(){const createdCommunities=[],user=yield this.userService.getById(req.user.id);try{for(var _c,_b=tslib_1.__asyncValues(user.createdCommunities);!(_c=yield _b.next()).done;){const communityId=_c.value;createdCommunities.push(yield this.getById(communityId.toString()))}}catch(e_2_1){e_2={error:e_2_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&(yield _a.call(_b))}finally{if(e_2)throw e_2.error}}return createdCommunities}))}create(createCommunityDto,req){var e_3,_a;return tslib_1.__awaiter(this,void 0,void 0,(function*(){yield this.validate(createCommunityDto);const embedCategories=[];try{for(var _c,_b=tslib_1.__asyncValues(createCommunityDto.categories);!(_c=yield _b.next()).done;){const category=_c.value;embedCategories.push(yield this.categoryService.getById(category))}}catch(e_3_1){e_3={error:e_3_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&(yield _a.call(_b))}finally{if(e_3)throw e_3.error}}const creator=yield this.userService.getById(req.user.id);delete creator.password;const mergedCommunity=new this.communityModel(Object.assign(Object.assign({},createCommunityDto),{creationDate:new Date,categories:embedCategories,createdBy:creator})),community=yield this.communityModel.create(mergedCommunity);return yield this.userService.addCreatedCommunity(req.user.id,community._id),console.log(community.threads),community}))}update(updateId,updateCommunityDto,req){var e_4,_a;return tslib_1.__awaiter(this,void 0,void 0,(function*(){yield this.doesExist(updateId),yield this.isAllowedToAlter(req.user.id,updateId,req),yield this.validate(updateCommunityDto,updateId);let updateObject={};if(updateCommunityDto.categories){const categories=[];try{for(var _c,_b=tslib_1.__asyncValues(updateCommunityDto.categories);!(_c=yield _b.next()).done;){const category=_c.value;categories.push(yield this.categoryService.getById(category))}}catch(e_4_1){e_4={error:e_4_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&(yield _a.call(_b))}finally{if(e_4)throw e_4.error}}delete updateCommunityDto.categories,updateObject={categories}}return updateObject=Object.assign(Object.assign({},updateCommunityDto),updateObject),this.communityModel.findOneAndUpdate({_id:updateId},updateObject,{new:!0})}))}delete(_id,req){var e_5,_a;return tslib_1.__awaiter(this,void 0,void 0,(function*(){yield this.doesExist(_id),yield this.isAllowedToAlter(req.user.id,_id,req);const community=yield this.communityModel.findOne({_id}),creator=yield this.userService.getById(community.createdBy._id.toString());yield this.userService.removeCreatedCommunity(creator._id.toString(),community._id);try{for(var _c,_b=tslib_1.__asyncValues(community.participants);!(_c=yield _b.next()).done;){const participantId=_c.value;yield this.userService.removeJoinedCommunity(participantId.toString(),community._id)}}catch(e_5_1){e_5={error:e_5_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&(yield _a.call(_b))}finally{if(e_5)throw e_5.error}}return yield this.communityModel.findOneAndDelete({_id})}))}join(communityId,req){return tslib_1.__awaiter(this,void 0,void 0,(function*(){if(yield this.doesExist(communityId),(yield this.communityModel.find({$and:[{_id:communityId},{"createdBy._id":req.user.id}]})).length>0)throw new common_1.HttpException("You cannot join your own community!",common_1.HttpStatus.BAD_REQUEST);if((yield(yield this.communityModel.find({$and:[{_id:communityId},{participants:{$in:req.user.id}}]})).length)>0)throw new common_1.HttpException("You are already a participant of this community!",common_1.HttpStatus.BAD_REQUEST);return yield this.userService.addJoinedCommunity(req.user.id,communityId),this.communityModel.findOneAndUpdate({_id:communityId},{$push:{participants:req.user.id}},{new:!0})}))}leave(communityId,req){return tslib_1.__awaiter(this,void 0,void 0,(function*(){if(yield this.doesExist(communityId),console.log(communityId),(yield this.communityModel.find({$and:[{_id:communityId},{"createdBy._id":req.user.id}]})).length>0)throw new common_1.HttpException("You cannot leave your own community!",common_1.HttpStatus.BAD_REQUEST);if(0===(yield(yield this.communityModel.find({$and:[{_id:communityId},{participants:{$in:req.user.id}}]})).length))throw new common_1.HttpException("You are not a participant of this community!",common_1.HttpStatus.BAD_REQUEST);return yield this.userService.removeJoinedCommunity(req.user.id,communityId),this.communityModel.findOneAndUpdate({_id:communityId},{$pull:{participants:req.user.id}},{new:!0})}))}updateCreator(creatorId,creator){return tslib_1.__awaiter(this,void 0,void 0,(function*(){yield this.communityModel.updateMany({"createdBy._id":creatorId},{$set:{createdBy:creator}})}))}validate(community,currentCommunityId){return tslib_1.__awaiter(this,void 0,void 0,(function*(){if(community.name&&(yield this.communityModel.find({$and:[{name:community.name},{_id:{$ne:currentCommunityId}}]})).length>0)throw new common_1.HttpException(`Community with the name of ${community.name} already exists!`,common_1.HttpStatus.BAD_REQUEST);if(community.categories&&!(yield this.areValidObjectIds(community.categories)))throw new common_1.HttpException("Categories contains invalid data, all input must be of type ObjectId!",common_1.HttpStatus.BAD_REQUEST)}))}areValidObjectIds(value){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return value.every((id=>ParseObjectIdPipe_1.ParseObjectIdPipe.isValidObjectId(id)))}))}isAllowedToAlter(currentUserId,communityId,req){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const community=yield this.communityModel.findOne({_id:communityId});if(!new mongoose_2.Types.ObjectId(currentUserId).equals(community.createdBy._id)&&!req.user.roles.includes(role_enum_1.Role.Admin))throw new common_1.HttpException("Only the creator can alter data of this community!",common_1.HttpStatus.BAD_REQUEST)}))}doesExist(communityId){return tslib_1.__awaiter(this,void 0,void 0,(function*(){if(!(yield this.communityModel.findOne({_id:communityId})))throw new common_1.HttpException(`Community with id of ${communityId} doesn't exist!`,common_1.HttpStatus.BAD_REQUEST)}))}};CommunityService=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__param(0,(0,mongoose_1.InjectModel)(community_schema_1.Community.name)),tslib_1.__param(2,(0,common_1.Inject)((0,common_1.forwardRef)((()=>user_service_1.UserService)))),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==mongoose_2.Model&&mongoose_2.Model)?_a:Object,"function"==typeof(_b=void 0!==category_service_1.CategoryService&&category_service_1.CategoryService)?_b:Object,"function"==typeof(_c=void 0!==user_service_1.UserService&&user_service_1.UserService)?_c:Object])],CommunityService),exports.CommunityService=CommunityService},9861:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b,_c,_d,_e,_f,_g,_h,_j;Object.defineProperty(exports,"__esModule",{value:!0}),exports.MessageController=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),auth_module_1=__webpack_require__(362),ParseObjectIdPipe_1=__webpack_require__(2840),message_dto_1=__webpack_require__(85),message_service_1=__webpack_require__(2320);let MessageController=class MessageController{constructor(messageService){this.messageService=messageService}getById(communityId,threadId,messageId){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log(`Getting message with id: ${messageId} (READ)`),yield this.messageService.getById(communityId,threadId,messageId)}))}getAll(communityId,threadId){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log("Getting all messages (READ)"),yield this.messageService.getAll(communityId,threadId)}))}create(communityId,threadId,req,messageDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log("Getting all messages (READ)"),yield this.messageService.create(communityId,threadId,req,messageDto)}))}update(communityId,threadId,messageId,req,messageDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log(`Getting thread with id: ${threadId} (UPDATE)`),this.messageService.update(communityId,threadId,messageId,messageDto,req)}))}delete(communityId,threadId,messageId,req){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log(`Getting thread with id: ${threadId} from community with id: ${communityId} (DELETE)`),this.messageService.delete(communityId,threadId,messageId,req)}))}like(communityId,threadId,messageId,req){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log(`Getting thread with id: ${threadId} (LIKE)`),this.messageService.like(communityId,threadId,messageId,req)}))}};tslib_1.__decorate([(0,auth_module_1.Public)(),(0,common_1.Get)("communities/:communityId/threads/:threadId/messages/:messageId"),tslib_1.__param(0,(0,common_1.Param)("communityId",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__param(1,(0,common_1.Param)("threadId",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__param(2,(0,common_1.Param)("messageId",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,String,String]),tslib_1.__metadata("design:returntype","function"==typeof(_b="undefined"!=typeof Promise&&Promise)?_b:Object)],MessageController.prototype,"getById",null),tslib_1.__decorate([(0,auth_module_1.Public)(),(0,common_1.Get)("communities/:communityId/threads/:threadId/messages"),tslib_1.__param(0,(0,common_1.Param)("communityId",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__param(1,(0,common_1.Param)("threadId",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,String]),tslib_1.__metadata("design:returntype","function"==typeof(_c="undefined"!=typeof Promise&&Promise)?_c:Object)],MessageController.prototype,"getAll",null),tslib_1.__decorate([(0,common_1.Post)("communities/:communityId/threads/:threadId/messages"),tslib_1.__param(0,(0,common_1.Param)("communityId",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__param(1,(0,common_1.Param)("threadId",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__param(2,(0,common_1.Req)()),tslib_1.__param(3,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,String,Object,"function"==typeof(_d=void 0!==message_dto_1.MessageDto&&message_dto_1.MessageDto)?_d:Object]),tslib_1.__metadata("design:returntype","function"==typeof(_e="undefined"!=typeof Promise&&Promise)?_e:Object)],MessageController.prototype,"create",null),tslib_1.__decorate([(0,common_1.Patch)("communities/:communityId/threads/:threadId/messages/:messageId"),tslib_1.__param(0,(0,common_1.Param)("communityId",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__param(1,(0,common_1.Param)("threadId",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__param(2,(0,common_1.Param)("messageId",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__param(3,(0,common_1.Req)()),tslib_1.__param(4,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,String,String,Object,"function"==typeof(_f=void 0!==message_dto_1.MessageDto&&message_dto_1.MessageDto)?_f:Object]),tslib_1.__metadata("design:returntype","function"==typeof(_g="undefined"!=typeof Promise&&Promise)?_g:Object)],MessageController.prototype,"update",null),tslib_1.__decorate([(0,common_1.Delete)("communities/:communityId/threads/:threadId/messages/:messageId"),tslib_1.__param(0,(0,common_1.Param)("communityId",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__param(1,(0,common_1.Param)("threadId",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__param(2,(0,common_1.Param)("messageId",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__param(3,(0,common_1.Req)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,String,String,Object]),tslib_1.__metadata("design:returntype","function"==typeof(_h="undefined"!=typeof Promise&&Promise)?_h:Object)],MessageController.prototype,"delete",null),tslib_1.__decorate([(0,common_1.Post)("communities/:communityId/threads/:threadId/messages/:messageId/like"),tslib_1.__param(0,(0,common_1.Param)("communityId",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__param(1,(0,common_1.Param)("threadId",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__param(2,(0,common_1.Param)("messageId",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__param(3,(0,common_1.Req)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,String,String,Object]),tslib_1.__metadata("design:returntype","function"==typeof(_j="undefined"!=typeof Promise&&Promise)?_j:Object)],MessageController.prototype,"like",null),MessageController=tslib_1.__decorate([(0,common_1.Controller)(),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==message_service_1.MessageService&&message_service_1.MessageService)?_a:Object])],MessageController),exports.MessageController=MessageController},85:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.MessageDto=void 0;const tslib_1=__webpack_require__(752),class_validator_1=__webpack_require__(5849);class MessageDto{}tslib_1.__decorate([(0,class_validator_1.IsString)({message:"Text must be a string!"}),(0,class_validator_1.IsDefined)({message:"Text is required!"}),tslib_1.__metadata("design:type",String)],MessageDto.prototype,"text",void 0),exports.MessageDto=MessageDto},527:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.MessageModule=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),mongoose_1=__webpack_require__(1794),community_module_1=__webpack_require__(908),message_controller_1=__webpack_require__(9861),message_schema_1=__webpack_require__(5360),message_service_1=__webpack_require__(2320);let MessageModule=class MessageModule{};MessageModule=tslib_1.__decorate([(0,common_1.Module)({imports:[mongoose_1.MongooseModule.forFeature([{name:message_schema_1.Message.name,schema:message_schema_1.MessageSchema}]),community_module_1.CommunityModule],providers:[message_service_1.MessageService],controllers:[message_controller_1.MessageController],exports:[message_service_1.MessageService]})],MessageModule),exports.MessageModule=MessageModule},5360:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b;Object.defineProperty(exports,"__esModule",{value:!0}),exports.MessageSchema=exports.Message=void 0;const tslib_1=__webpack_require__(752),mongoose_1=__webpack_require__(1794),class_validator_1=__webpack_require__(5849),mongoose_2=__webpack_require__(1185);let Message=class Message{};tslib_1.__decorate([(0,class_validator_1.IsString)({message:"Text must be a string!"}),(0,class_validator_1.IsDefined)({message:"Text is required!"}),(0,mongoose_1.Prop)({unique:!0}),tslib_1.__metadata("design:type",String)],Message.prototype,"text",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)({dedfault:[],ref:"User"}),tslib_1.__metadata("design:type",Array)],Message.prototype,"likes",void 0),tslib_1.__decorate([(0,class_validator_1.IsDate)({message:"Creation date must be a date!"}),(0,mongoose_1.Prop)(),tslib_1.__metadata("design:type","function"==typeof(_a="undefined"!=typeof Date&&Date)?_a:Object)],Message.prototype,"publicationDate",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)({ref:"User"}),tslib_1.__metadata("design:type","function"==typeof(_b=void 0!==mongoose_2.ObjectId&&mongoose_2.ObjectId)?_b:Object)],Message.prototype,"createdBy",void 0),Message=tslib_1.__decorate([(0,mongoose_1.Schema)()],Message),exports.Message=Message,exports.MessageSchema=mongoose_1.SchemaFactory.createForClass(Message)},2320:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b;Object.defineProperty(exports,"__esModule",{value:!0}),exports.MessageService=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),mongoose_1=__webpack_require__(1794),mongoose_2=__webpack_require__(1185),role_enum_1=__webpack_require__(1360),community_schema_1=__webpack_require__(637),message_schema_1=__webpack_require__(5360);let MessageService=class MessageService{constructor(communityModel,messageModel){this.communityModel=communityModel,this.messageModel=messageModel}getById(communityId,threadId,messageId){return tslib_1.__awaiter(this,void 0,void 0,(function*(){yield this.doesExist(communityId,threadId,messageId);const thread=(yield this.communityModel.aggregate([{$match:{_id:new mongoose_2.Types.ObjectId(communityId)}},{$unwind:{path:"$participants",preserveNullAndEmptyArrays:!0}},{$project:{_id:0,threads:{$filter:{input:"$threads",as:"thread",cond:!0}}}},{$unwind:{path:"$threads",preserveNullAndEmptyArrays:!1}},{$unwind:{path:"$threads.createdBy",preserveNullAndEmptyArrays:!0}},{$lookup:{from:"users",localField:"threads.createdBy",foreignField:"_id",as:"threads.createdBy"}},{$unwind:{path:"$threads.messages",preserveNullAndEmptyArrays:!0}},{$lookup:{from:"users",localField:"threads.messages.createdBy",foreignField:"_id",as:"threads.messages.createdBy"}},{$set:{"threads.messages.createdBy":"$threads.messages.createdBy"}},{$group:{_id:"$threads._id",messages:{$push:"$threads.messages"}}},{$unset:["messages.createdBy.password","messages.createdBy.__v"]}]))[0].messages.filter((message=>new mongoose_2.Types.ObjectId(message._id).equals(new mongoose_2.Types.ObjectId(messageId))))[0];return Object.assign(Object.assign({},thread),{createdBy:thread.createdBy[0]})}))}getAll(communityId,threadId){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.doesExist(communityId,threadId),(yield this.communityModel.aggregate([{$match:{_id:new mongoose_2.Types.ObjectId(communityId)}},{$unwind:{path:"$participants",preserveNullAndEmptyArrays:!0}},{$project:{_id:0,threads:{$filter:{input:"$threads",as:"thread",cond:!0}}}},{$unwind:{path:"$threads",preserveNullAndEmptyArrays:!1}},{$unwind:{path:"$threads.createdBy",preserveNullAndEmptyArrays:!0}},{$lookup:{from:"users",localField:"threads.createdBy",foreignField:"_id",as:"threads.createdBy"}},{$unwind:{path:"$threads.messages",preserveNullAndEmptyArrays:!0}},{$lookup:{from:"users",localField:"threads.messages.createdBy",foreignField:"_id",as:"threads.messages.createdBy"}},{$set:{"threads.messages.createdBy":"$threads.messages.createdBy"}},{$group:{_id:"$threads._id",messages:{$push:"$threads.messages"}}},{$unset:["messages.createdBy.password","messages.createdBy.__v"]}]))[0].messages.map((message=>Object.assign(Object.assign({},message),{createdBy:message.createdBy[0]})))}))}create(communityId,threadId,req,messageDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){yield this.doesExist(communityId,threadId);const community=yield this.communityModel.findOne({_id:communityId});if(!((yield this.communityModel.find({$and:[{_id:communityId},{participants:{$in:[req.user.id]}}]})).length>0||community.createdBy._id.equals(new mongoose_2.Types.ObjectId(req.user.id))||req.user.roles.includes(role_enum_1.Role.Admin)))throw new common_1.HttpException("You are not a member of this community!",common_1.HttpStatus.BAD_REQUEST);const mergedMessage=new this.messageModel(Object.assign(Object.assign({},messageDto),{publicationDate:new Date,createdBy:req.user.id}));return(yield this.communityModel.findOneAndUpdate({_id:communityId},{$push:{"threads.$[thread].messages":mergedMessage}},{arrayFilters:[{"thread._id":new mongoose_2.Types.ObjectId(threadId)}],new:!0})).threads.filter((thread=>thread._id.equals(new mongoose_2.Types.ObjectId(threadId))))[0].messages.filter((message=>message._id.equals(mergedMessage._id)))[0]}))}update(communityId,threadId,messageId,messageDto,req){return tslib_1.__awaiter(this,void 0,void 0,(function*(){yield this.doesExist(communityId,threadId,messageId);const oldMessage=yield this.getById(communityId,threadId,messageId),message=Object.assign(Object.assign({},oldMessage),messageDto);if(!(yield this.isMyData(message.createdBy.toString(),req.user.id))&&!req.user.roles.includes(role_enum_1.Role.Admin))throw new common_1.HttpException("You cannot alter data that isn't yours!",common_1.HttpStatus.BAD_REQUEST);return(yield this.communityModel.findOneAndUpdate({_id:new mongoose_2.Types.ObjectId(communityId),"threads._id":new mongoose_2.Types.ObjectId(threadId)},{$push:{"threads.$.messages":Object.assign(Object.assign({},message),messageDto)}},{new:!0})).threads.filter((thread=>thread._id.equals(new mongoose_2.Types.ObjectId(threadId))))[0].messages.filter((message=>message._id.equals(new mongoose_2.Types.ObjectId(messageId))))[0]}))}delete(communityId,threadId,messageId,req){return tslib_1.__awaiter(this,void 0,void 0,(function*(){yield this.doesExist(communityId,threadId,messageId);const message=yield this.getById(communityId,threadId,messageId);if(!(yield this.isMyData(message.createdBy.toString(),req.user.id))&&!req.user.roles.includes(role_enum_1.Role.Admin))throw new common_1.HttpException("You cannot alter data that isn't yours!",common_1.HttpStatus.BAD_REQUEST);return(yield this.communityModel.findOneAndUpdate({_id:new mongoose_2.Types.ObjectId(communityId),"threads._id":new mongoose_2.Types.ObjectId(threadId)},{$pull:{"threads.$.messages":message}},{new:!0})).threads.filter((thread=>thread._id.equals(new mongoose_2.Types.ObjectId(threadId))))[0]}))}like(communityId,threadId,messageId,req){return tslib_1.__awaiter(this,void 0,void 0,(function*(){let community;return yield this.doesExist(communityId,threadId,messageId),community=0===(yield this.communityModel.find({$and:[{_id:communityId},{threads:{$elemMatch:{_id:threadId,messages:{$elemMatch:{_id:messageId,likes:{$in:[req.user.id]}}}}}}]})).length?yield this.communityModel.findOneAndUpdate({_id:new mongoose_2.Types.ObjectId(communityId),"threads._id":new mongoose_2.Types.ObjectId(threadId)},{$push:{"threads.$.messages.$[message].likes":req.user.id}},{arrayFilters:[{"message._id":new mongoose_2.Types.ObjectId(messageId)}],new:!0}):yield this.communityModel.findOneAndUpdate({_id:new mongoose_2.Types.ObjectId(communityId),"threads._id":new mongoose_2.Types.ObjectId(threadId)},{$pull:{"threads.$.messages.$[message].likes":req.user.id}},{arrayFilters:[{"message._id":new mongoose_2.Types.ObjectId(messageId)}],new:!0}),community.threads.filter((thread=>thread._id.equals(new mongoose_2.Types.ObjectId(threadId))))[0].messages.filter((message=>message._id.equals(new mongoose_2.Types.ObjectId(messageId))))[0]}))}isMyData(currentUserId,targetUserId){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return new mongoose_2.Types.ObjectId(currentUserId).equals(new mongoose_2.Types.ObjectId(targetUserId))}))}doesExist(communityId,threadId,messageId){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const community=yield this.communityModel.findOne({_id:communityId});let threads;if(!community)throw new common_1.HttpException(`Community with id of ${communityId} doesn't exist!`,common_1.HttpStatus.BAD_REQUEST);if(threadId&&(threads=yield community.threads.filter((thread=>thread._id.equals(new mongoose_2.Types.ObjectId(threadId)))),!(threads.length>0)))throw new common_1.HttpException(`Thread with id of ${threadId} doesn't exist in the community with id of ${communityId}!`,common_1.HttpStatus.BAD_REQUEST);if(threadId&&messageId&&!(threads[0].messages.filter((message=>message._id.equals(new mongoose_2.Types.ObjectId(messageId)))).length>0))throw new common_1.HttpException(`Message with id of ${messageId} doesn't exist in the thread with id of ${threadId}!`,common_1.HttpStatus.BAD_REQUEST)}))}};MessageService=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__param(0,(0,mongoose_1.InjectModel)(community_schema_1.Community.name)),tslib_1.__param(1,(0,mongoose_1.InjectModel)(message_schema_1.Message.name)),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==mongoose_2.Model&&mongoose_2.Model)?_a:Object,"function"==typeof(_b=void 0!==mongoose_2.Model&&mongoose_2.Model)?_b:Object])],MessageService),exports.MessageService=MessageService},3499:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0})},6682:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.NEO4J_DRIVER=exports.NEO4J_CONFIG=void 0,exports.NEO4J_CONFIG="NEO4J_CONFIG",exports.NEO4J_DRIVER="NEO4J_DRIVER"},7641:(__unused_webpack_module,exports,__webpack_require__)=>{var Neo4jModule_1;Object.defineProperty(exports,"__esModule",{value:!0}),exports.Neo4jModule=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),neo4j_constants_1=__webpack_require__(6682),neo4j_service_1=__webpack_require__(857),neo4j_util_1=__webpack_require__(5961);let Neo4jModule=Neo4jModule_1=class Neo4jModule{static forRoot(config){return{module:Neo4jModule_1,providers:[neo4j_service_1.Neo4jService,{provide:neo4j_constants_1.NEO4J_CONFIG,useValue:config},{provide:neo4j_constants_1.NEO4J_DRIVER,inject:[neo4j_constants_1.NEO4J_CONFIG],useFactory:config=>(0,neo4j_util_1.createDriver)(config)}],exports:[neo4j_service_1.Neo4jService]}}};Neo4jModule=Neo4jModule_1=tslib_1.__decorate([(0,common_1.Module)({})],Neo4jModule),exports.Neo4jModule=Neo4jModule},857:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b;Object.defineProperty(exports,"__esModule",{value:!0}),exports.Neo4jService=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),neo4j_driver_1=__webpack_require__(3255),neo4j_config_interface_1=__webpack_require__(3499),neo4j_constants_1=__webpack_require__(6682);let Neo4jService=class Neo4jService{constructor(config,driver){this.config=config,this.driver=driver}getDriver(){return this.driver}getConfig(){return this.config}getReadSession(database){return this.driver.session({database:database||this.config.database,defaultAccessMode:neo4j_driver_1.default.session.READ})}getWriteSession(database){return this.driver.session({database:database||this.config.database,defaultAccessMode:neo4j_driver_1.default.session.WRITE})}read(cypher,params,database){return this.getReadSession(database).run(cypher,params)}write(cypher,params,database){return this.getWriteSession(database).run(cypher,params)}};Neo4jService=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__param(0,(0,common_1.Inject)(neo4j_constants_1.NEO4J_CONFIG)),tslib_1.__param(1,(0,common_1.Inject)(neo4j_constants_1.NEO4J_DRIVER)),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==neo4j_config_interface_1.Neo4jConfig&&neo4j_config_interface_1.Neo4jConfig)?_a:Object,"function"==typeof(_b=void 0!==neo4j_driver_1.Driver&&neo4j_driver_1.Driver)?_b:Object])],Neo4jService),exports.Neo4jService=Neo4jService},5961:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.createDriver=void 0;const tslib_1=__webpack_require__(752),neo4j_driver_1=__webpack_require__(3255);exports.createDriver=config=>tslib_1.__awaiter(void 0,void 0,void 0,(function*(){const driver=neo4j_driver_1.default.driver(`${config.scheme}://${config.host}:${config.port}`,neo4j_driver_1.default.auth.basic(config.username,config.password));return yield driver.verifyConnectivity(),driver}))},4625:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.ValidationException=void 0;const common_1=__webpack_require__(6481);class ValidationException extends common_1.BadRequestException{constructor(validationErrors){super(),this.validationErrors=validationErrors}}exports.ValidationException=ValidationException},8868:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.ValidationFilter=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),validation_exception_1=__webpack_require__(4625);let ValidationFilter=class ValidationFilter{catch(exception,host){return host.switchToHttp().getResponse().status(400).json({statusCode:400,timestamp:(new Date).toISOString(),errors:exception.validationErrors})}};ValidationFilter=tslib_1.__decorate([(0,common_1.Catch)(validation_exception_1.ValidationException)],ValidationFilter),exports.ValidationFilter=ValidationFilter},2840:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.ParseObjectIdPipe=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),mongodb_1=__webpack_require__(8013),validation_exception_1=__webpack_require__(4625);let ParseObjectIdPipe=class ParseObjectIdPipe{transform(value){try{return mongodb_1.ObjectId.createFromHexString(value)}catch(error){throw new validation_exception_1.ValidationException([`ObjectId has wrong value: ${value}, ObjectId is not valid!`])}}static isValidObjectId(value){try{return mongodb_1.ObjectId.createFromHexString(value),!0}catch(error){return!1}}};ParseObjectIdPipe=tslib_1.__decorate([(0,common_1.Injectable)()],ParseObjectIdPipe),exports.ParseObjectIdPipe=ParseObjectIdPipe},4760:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.UpdateThreadDto=exports.CreateThreadDto=void 0;const tslib_1=__webpack_require__(752),class_validator_1=__webpack_require__(5849);class CreateThreadDto{}tslib_1.__decorate([(0,class_validator_1.IsString)({message:"Title must be a string!"}),(0,class_validator_1.IsDefined)({message:"Title is required!"}),(0,class_validator_1.MinLength)(5,{message:"Title must be at least 5 characters long!"}),tslib_1.__metadata("design:type",String)],CreateThreadDto.prototype,"title",void 0),tslib_1.__decorate([(0,class_validator_1.IsString)({message:"Content must be a string!"}),(0,class_validator_1.IsDefined)({message:"Content is required!"}),tslib_1.__metadata("design:type",String)],CreateThreadDto.prototype,"content",void 0),tslib_1.__decorate([(0,class_validator_1.IsString)({message:"ImageUrl must be a string!"}),(0,class_validator_1.IsDefined)({message:"ImageUrl is required!"}),tslib_1.__metadata("design:type",String)],CreateThreadDto.prototype,"imageUrl",void 0),tslib_1.__decorate([(0,class_validator_1.IsString)({message:"ExternLink must be a string!"}),(0,class_validator_1.IsDefined)({message:"ExternLink is required!"}),tslib_1.__metadata("design:type",String)],CreateThreadDto.prototype,"externLink",void 0),exports.CreateThreadDto=CreateThreadDto;class UpdateThreadDto{}tslib_1.__decorate([(0,class_validator_1.IsOptional)(),(0,class_validator_1.IsString)({message:"Title must be a string!"}),(0,class_validator_1.IsDefined)({message:"Title is required!"}),(0,class_validator_1.MinLength)(5,{message:"Title must be at least 5 characters long!"}),tslib_1.__metadata("design:type",String)],UpdateThreadDto.prototype,"title",void 0),tslib_1.__decorate([(0,class_validator_1.IsOptional)(),(0,class_validator_1.IsString)({message:"Content must be a string!"}),(0,class_validator_1.IsDefined)({message:"Content is required!"}),tslib_1.__metadata("design:type",String)],UpdateThreadDto.prototype,"content",void 0),tslib_1.__decorate([(0,class_validator_1.IsOptional)(),(0,class_validator_1.IsString)({message:"ImageUrl must be a string!"}),(0,class_validator_1.IsDefined)({message:"ImageUrl is required!"}),tslib_1.__metadata("design:type",String)],UpdateThreadDto.prototype,"imageUrl",void 0),tslib_1.__decorate([(0,class_validator_1.IsOptional)(),(0,class_validator_1.IsString)({message:"ExternLink must be a string!"}),(0,class_validator_1.IsDefined)({message:"ExternLink is required!"}),tslib_1.__metadata("design:type",String)],UpdateThreadDto.prototype,"externLink",void 0),exports.UpdateThreadDto=UpdateThreadDto},8016:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b,_c,_d,_e,_f,_g,_h,_j;Object.defineProperty(exports,"__esModule",{value:!0}),exports.ThreadController=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),auth_module_1=__webpack_require__(362),ParseObjectIdPipe_1=__webpack_require__(2840),thread_dto_1=__webpack_require__(4760),thread_service_1=__webpack_require__(5596);let ThreadController=class ThreadController{constructor(threadService){this.threadService=threadService}getById(communityId,threadId){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log(`Getting thread with id: ${threadId} from community with id of ${communityId} (READ)`),yield this.threadService.getById(communityId,threadId)}))}getAll(communityId){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log(`Getting all threads from community with an id of: ${communityId} (READ)`),this.threadService.getAll(communityId)}))}create(communityId,req,createThreadDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log("Creating thread (CREATE)"),this.threadService.create(createThreadDto,communityId,req)}))}update(communityId,threadId,req,updateThreadDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log(`Getting thread with id: ${threadId} (UPDATE)`),this.threadService.update(communityId,threadId,req,updateThreadDto)}))}delete(communityId,threadId,req){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log(`Getting thread with id: ${threadId} from community with id: ${communityId} (DELETE)`),this.threadService.delete(communityId,threadId,req)}))}upvote(communityId,threadId,req){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log("Creating thread (CREATE)"),this.threadService.upvote(communityId,threadId,req)}))}};tslib_1.__decorate([(0,auth_module_1.Public)(),(0,common_1.Get)("communities/:communityId/threads/:threadId"),tslib_1.__param(0,(0,common_1.Param)("communityId",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__param(1,(0,common_1.Param)("threadId",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,String]),tslib_1.__metadata("design:returntype","function"==typeof(_b="undefined"!=typeof Promise&&Promise)?_b:Object)],ThreadController.prototype,"getById",null),tslib_1.__decorate([(0,auth_module_1.Public)(),(0,common_1.Get)("communities/:communityId/threads"),tslib_1.__param(0,(0,common_1.Param)("communityId",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String]),tslib_1.__metadata("design:returntype","function"==typeof(_c="undefined"!=typeof Promise&&Promise)?_c:Object)],ThreadController.prototype,"getAll",null),tslib_1.__decorate([(0,common_1.Post)("communities/:communityId/threads"),tslib_1.__param(0,(0,common_1.Param)("communityId",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__param(1,(0,common_1.Req)()),tslib_1.__param(2,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,Object,"function"==typeof(_d=void 0!==thread_dto_1.CreateThreadDto&&thread_dto_1.CreateThreadDto)?_d:Object]),tslib_1.__metadata("design:returntype","function"==typeof(_e="undefined"!=typeof Promise&&Promise)?_e:Object)],ThreadController.prototype,"create",null),tslib_1.__decorate([(0,common_1.Patch)("communities/:communityId/threads/:threadId"),tslib_1.__param(0,(0,common_1.Param)("communityId",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__param(1,(0,common_1.Param)("threadId",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__param(2,(0,common_1.Req)()),tslib_1.__param(3,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,String,Object,"function"==typeof(_f=void 0!==thread_dto_1.UpdateThreadDto&&thread_dto_1.UpdateThreadDto)?_f:Object]),tslib_1.__metadata("design:returntype","function"==typeof(_g="undefined"!=typeof Promise&&Promise)?_g:Object)],ThreadController.prototype,"update",null),tslib_1.__decorate([(0,common_1.Delete)("communities/:communityId/threads/:threadId"),tslib_1.__param(0,(0,common_1.Param)("communityId",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__param(1,(0,common_1.Param)("threadId",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__param(2,(0,common_1.Req)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,String,Object]),tslib_1.__metadata("design:returntype","function"==typeof(_h="undefined"!=typeof Promise&&Promise)?_h:Object)],ThreadController.prototype,"delete",null),tslib_1.__decorate([(0,common_1.Post)("communities/:communityId/threads/:threadId/upvote"),tslib_1.__param(0,(0,common_1.Param)("communityId",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__param(1,(0,common_1.Param)("threadId",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__param(2,(0,common_1.Req)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,String,Object]),tslib_1.__metadata("design:returntype","function"==typeof(_j="undefined"!=typeof Promise&&Promise)?_j:Object)],ThreadController.prototype,"upvote",null),ThreadController=tslib_1.__decorate([(0,common_1.Controller)(),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==thread_service_1.ThreadService&&thread_service_1.ThreadService)?_a:Object])],ThreadController),exports.ThreadController=ThreadController},2664:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.ThreadModule=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),mongoose_1=__webpack_require__(1794),community_module_1=__webpack_require__(908),user_module_1=__webpack_require__(6642),thread_controller_1=__webpack_require__(8016),thread_schema_1=__webpack_require__(6201),thread_service_1=__webpack_require__(5596);let ThreadModule=class ThreadModule{};ThreadModule=tslib_1.__decorate([(0,common_1.Module)({imports:[mongoose_1.MongooseModule.forFeature([{name:thread_schema_1.Thread.name,schema:thread_schema_1.ThreadSchema}]),community_module_1.CommunityModule,user_module_1.UserModule],controllers:[thread_controller_1.ThreadController],providers:[thread_service_1.ThreadService,mongoose_1.MongooseModule]})],ThreadModule),exports.ThreadModule=ThreadModule},6201:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b;Object.defineProperty(exports,"__esModule",{value:!0}),exports.ThreadSchema=exports.Thread=void 0;const tslib_1=__webpack_require__(752),mongoose_1=__webpack_require__(1794),class_validator_1=__webpack_require__(5849),mongoose_2=__webpack_require__(1185);let Thread=class Thread{};tslib_1.__decorate([(0,class_validator_1.IsString)({message:"Name must be a string!"}),(0,class_validator_1.IsDefined)({message:"Name is required!"}),(0,class_validator_1.MinLength)(5,{message:"Name must be at least 5 characters long!"}),(0,mongoose_1.Prop)(),tslib_1.__metadata("design:type",String)],Thread.prototype,"title",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)(),tslib_1.__metadata("design:type",String)],Thread.prototype,"content",void 0),tslib_1.__decorate([(0,class_validator_1.IsString)({message:"Image URL must be a string!"}),(0,mongoose_1.Prop)(),tslib_1.__metadata("design:type",String)],Thread.prototype,"imageUrl",void 0),tslib_1.__decorate([(0,class_validator_1.IsString)({message:"ExternLink must be a string!"}),(0,mongoose_1.Prop)(),tslib_1.__metadata("design:type",String)],Thread.prototype,"externLink",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)(),tslib_1.__metadata("design:type",Number)],Thread.prototype,"views",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)({default:[],ref:"User"}),tslib_1.__metadata("design:type",Array)],Thread.prototype,"upvotes",void 0),tslib_1.__decorate([(0,class_validator_1.IsDate)({message:"Publication date must be a date!"}),(0,mongoose_1.Prop)(),tslib_1.__metadata("design:type","function"==typeof(_a="undefined"!=typeof Date&&Date)?_a:Object)],Thread.prototype,"publicationDate",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)({default:[]}),tslib_1.__metadata("design:type",Array)],Thread.prototype,"messages",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)({ref:"User"}),tslib_1.__metadata("design:type","function"==typeof(_b=void 0!==mongoose_2.ObjectId&&mongoose_2.ObjectId)?_b:Object)],Thread.prototype,"createdBy",void 0),Thread=tslib_1.__decorate([(0,mongoose_1.Schema)()],Thread),exports.Thread=Thread,exports.ThreadSchema=mongoose_1.SchemaFactory.createForClass(Thread)},5596:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b;Object.defineProperty(exports,"__esModule",{value:!0}),exports.ThreadService=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),mongoose_1=__webpack_require__(1794),mongoose_2=__webpack_require__(1185),role_enum_1=__webpack_require__(1360),community_schema_1=__webpack_require__(637),user_service_1=__webpack_require__(5680);let ThreadService=class ThreadService{constructor(communityModel,userService){this.communityModel=communityModel,this.userService=userService}getById(communityId,threadId){return tslib_1.__awaiter(this,void 0,void 0,(function*(){yield this.doesExist(communityId,threadId),yield this.communityModel.findOneAndUpdate({_id:new mongoose_2.Types.ObjectId(communityId),"threads._id":new mongoose_2.Types.ObjectId(threadId)},{$inc:{"threads.$.views":1}});const thread=(yield this.communityModel.aggregate([{$match:{_id:new mongoose_2.Types.ObjectId(communityId)}},{$match:{"threads._id":new mongoose_2.Types.ObjectId(threadId)}},{$unwind:{path:"$participants",preserveNullAndEmptyArrays:!0}},{$project:{_id:0,threads:{$filter:{input:"$threads",as:"thread",cond:{$eq:["$$thread._id",new mongoose_2.Types.ObjectId(threadId)]}}}}},{$unwind:{path:"$threads",preserveNullAndEmptyArrays:!0}},{$lookup:{from:"users",localField:"threads.createdBy",foreignField:"_id",as:"threads.createdBy"}},{$unwind:{path:"$threads.messages",preserveNullAndEmptyArrays:!0}},{$lookup:{from:"users",localField:"threads.messages.createdBy",foreignField:"_id",as:"threads.messages.createdBy"}},{$set:{"threads.messages.createdBy":"$threads.messages.createdBy"}},{$group:{_id:"$threads._id",title:{$first:"$threads.title"},content:{$first:"$threads.content"},externLink:{$first:"$threads.externLink"},views:{$first:"$threads.views"},imageUrl:{$first:"$threads.imageUrl"},upvotes:{$first:"$threads.upvotes"},messages:{$push:"$threads.messages"},publicationDate:{$first:"$threads.publicationDate"},createdBy:{$first:"$threads.createdBy"}}},{$unset:["createdBy.password","createdBy.__v","messages.createdBy.password","messages.createdBy.__v"]}]))[0];return Object.assign(Object.assign({},thread),{createdBy:thread.createdBy[0],messages:thread.messages.map((message=>Object.assign(Object.assign({},message),{createdBy:message.createdBy[0]})))})}))}getAll(communityId){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.doesExist(communityId),(yield this.communityModel.aggregate([{$match:{_id:new mongoose_2.Types.ObjectId(communityId)}},{$unwind:{path:"$participants",preserveNullAndEmptyArrays:!0}},{$project:{_id:0,threads:{$filter:{input:"$threads",as:"thread",cond:!0}}}},{$unwind:{path:"$threads",preserveNullAndEmptyArrays:!1}},{$unwind:{path:"$threads.createdBy",preserveNullAndEmptyArrays:!0}},{$lookup:{from:"users",localField:"threads.createdBy",foreignField:"_id",as:"threads.createdBy"}},{$unwind:{path:"$threads.messages",preserveNullAndEmptyArrays:!0}},{$lookup:{from:"users",localField:"threads.messages.createdBy",foreignField:"_id",as:"threads.messages.createdBy"}},{$set:{"threads.messages.createdBy":"$threads.messages.createdBy"}},{$group:{_id:"$threads._id",title:{$first:"$threads.title"},content:{$first:"$threads.content"},externLink:{$first:"$threads.externLink"},views:{$first:"$threads.views"},imageUrl:{$first:"$threads.imageUrl"},upvotes:{$first:"$threads.upvotes"},messages:{$push:"$threads.messages"},publicationDate:{$first:"$threads.publicationDate"},createdBy:{$first:"$threads.createdBy"}}},{$unset:["createdBy.password","createdBy.__v","messages.createdBy.password","messages.createdBy.__v"]}])).map((thread=>Object.assign(Object.assign({},thread),{createdBy:thread.createdBy[0],messages:thread.messages.map((message=>Object.assign(Object.assign({},message),{createdBy:message.createdBy[0]})))})))}))}create(createThreadDto,communityId,req){return tslib_1.__awaiter(this,void 0,void 0,(function*(){yield this.doesExist(communityId);const community=yield this.communityModel.findOne({_id:communityId});if(!((yield this.communityModel.find({$and:[{_id:communityId},{participants:{$in:[req.user.id]}}]})).length>0||community.createdBy._id.equals(new mongoose_2.Types.ObjectId(req.user.id))||req.user.roles.includes(role_enum_1.Role.Admin)))throw new common_1.HttpException("You are not a member of this community",common_1.HttpStatus.BAD_REQUEST);const mergedthread=Object.assign(Object.assign({_id:new mongoose_2.Types.ObjectId},createThreadDto),{views:0,upvotes:[],publicationDate:new Date,messages:[],createdBy:req.user.id});return yield this.communityModel.findOneAndUpdate({_id:communityId},{$push:{threads:mergedthread}},{new:!0})}))}update(communityId,threadId,req,updateThreadDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){yield this.doesExist(communityId,threadId);const thread=(yield this.communityModel.findOne({_id:communityId},{threads:{$elemMatch:{_id:threadId}}})).threads.filter((thread=>tslib_1.__awaiter(this,void 0,void 0,(function*(){return thread._id===new mongoose_2.Types.ObjectId(threadId)}))))[0];if(!(yield this.isMyData(thread.createdBy.toString(),req.user.id))&&!req.user.roles.includes(role_enum_1.Role.Admin))throw new common_1.HttpException("You cannot alter data that isn't yours!",common_1.HttpStatus.BAD_REQUEST);return yield this.communityModel.findOneAndUpdate({_id:communityId,"threads._id":threadId},{$set:{"threads.$":Object.assign(Object.assign({},thread),updateThreadDto)}},{new:!0})}))}delete(communityId,threadId,req){return tslib_1.__awaiter(this,void 0,void 0,(function*(){yield this.doesExist(communityId,threadId);const thread=(yield this.communityModel.findOne({_id:communityId},{threads:{$elemMatch:{_id:threadId}}})).threads.filter((thread=>tslib_1.__awaiter(this,void 0,void 0,(function*(){return thread._id===new mongoose_2.Types.ObjectId(threadId)}))))[0];if(!(yield this.isMyData(thread.createdBy.toString(),req.user.id))&&!req.user.roles.includes(role_enum_1.Role.Admin))throw new common_1.HttpException("You cannot alter data that isn't yours!",common_1.HttpStatus.BAD_REQUEST);return yield this.communityModel.findOneAndUpdate({_id:new mongoose_2.Types.ObjectId(communityId)},{$pull:{threads:{_id:new mongoose_2.Types.ObjectId(threadId)}}},{new:!0})}))}upvote(communityId,threadId,req){return tslib_1.__awaiter(this,void 0,void 0,(function*(){let community;return yield this.doesExist(communityId,threadId),community=0===(yield this.communityModel.find({$and:[{_id:communityId},{threads:{$elemMatch:{_id:threadId,upvotes:{$in:[req.user.id]}}}}]})).length?yield this.communityModel.findOneAndUpdate({_id:communityId,"threads._id":threadId},{$push:{"threads.$.upvotes":req.user.id}},{new:!0}):yield this.communityModel.findOneAndUpdate({_id:communityId,"threads._id":threadId},{$pull:{"threads.$.upvotes":req.user.id}},{new:!0}),community.threads.filter((thread=>tslib_1.__awaiter(this,void 0,void 0,(function*(){return thread._id===new mongoose_2.Types.ObjectId(threadId)}))))[0]}))}isMyData(currentUserId,targetUserId){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return new mongoose_2.Types.ObjectId(currentUserId).equals(new mongoose_2.Types.ObjectId(targetUserId))}))}doesExist(communityId,threadId){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const community=yield this.communityModel.findOne({_id:communityId});if(!community)throw new common_1.HttpException(`Community with id of ${communityId} doesn't exist!`,common_1.HttpStatus.BAD_REQUEST);if(threadId&&!(community.threads.filter((thread=>thread._id.equals(new mongoose_2.Types.ObjectId(threadId)))).length>0))throw new common_1.HttpException(`Thread with id of ${threadId} doesn't exist in the community with id of ${communityId}!`,common_1.HttpStatus.BAD_REQUEST)}))}};ThreadService=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__param(0,(0,mongoose_1.InjectModel)(community_schema_1.Community.name)),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==mongoose_2.Model&&mongoose_2.Model)?_a:Object,"function"==typeof(_b=void 0!==user_service_1.UserService&&user_service_1.UserService)?_b:Object])],ThreadService),exports.ThreadService=ThreadService},5755:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b,_c,_d,_e,_f,_g,_h;Object.defineProperty(exports,"__esModule",{value:!0}),exports.UserController=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),auth_module_1=__webpack_require__(362),role_enum_1=__webpack_require__(1360),ParseObjectIdPipe_1=__webpack_require__(2840),user_dto_1=__webpack_require__(7513),user_service_1=__webpack_require__(5680);let UserController=class UserController{constructor(userService){this.userService=userService}getById(id){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log(`Getting user with id: ${id} (READ)`),yield this.userService.getById(id)}))}getAll(){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log("Getting all users (READ)"),this.userService.getAll()}))}create(createUserDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log("Creating community (CREATE)"),this.userService.create(createUserDto)}))}update(req,id,updateUserDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log(`Getting user with id: ${id} (UPDATE)`),this.userService.update(id,updateUserDto,req)}))}follow(req,id){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log(`Getting user with id: ${id} (READ)`),this.userService.follow(id,req)}))}unfollow(req,id){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log(`Getting user with id: ${id} (READ)`),this.userService.unfollow(id,req)}))}};tslib_1.__decorate([(0,common_1.Get)("users/:id"),tslib_1.__param(0,(0,common_1.Param)("id",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String]),tslib_1.__metadata("design:returntype","function"==typeof(_b="undefined"!=typeof Promise&&Promise)?_b:Object)],UserController.prototype,"getById",null),tslib_1.__decorate([(0,common_1.Get)("users"),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[]),tslib_1.__metadata("design:returntype","function"==typeof(_c="undefined"!=typeof Promise&&Promise)?_c:Object)],UserController.prototype,"getAll",null),tslib_1.__decorate([(0,auth_module_1.Roles)(role_enum_1.Role.Admin),(0,common_1.Post)("users"),tslib_1.__param(0,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",["function"==typeof(_d=void 0!==user_dto_1.CreateUserDto&&user_dto_1.CreateUserDto)?_d:Object]),tslib_1.__metadata("design:returntype","function"==typeof(_e="undefined"!=typeof Promise&&Promise)?_e:Object)],UserController.prototype,"create",null),tslib_1.__decorate([(0,common_1.Patch)("users/:id"),tslib_1.__param(0,(0,common_1.Req)()),tslib_1.__param(1,(0,common_1.Param)("id",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__param(2,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[Object,String,"function"==typeof(_f=void 0!==user_dto_1.UpdateUserDto&&user_dto_1.UpdateUserDto)?_f:Object]),tslib_1.__metadata("design:returntype","function"==typeof(_g="undefined"!=typeof Promise&&Promise)?_g:Object)],UserController.prototype,"update",null),tslib_1.__decorate([(0,common_1.Post)("users/:id/follow"),tslib_1.__param(0,(0,common_1.Req)()),tslib_1.__param(1,(0,common_1.Param)("id",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[Object,String]),tslib_1.__metadata("design:returntype","function"==typeof(_h="undefined"!=typeof Promise&&Promise)?_h:Object)],UserController.prototype,"follow",null),tslib_1.__decorate([(0,common_1.Post)("users/:id/unfollow"),tslib_1.__param(0,(0,common_1.Req)()),tslib_1.__param(1,(0,common_1.Param)("id",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[Object,String]),tslib_1.__metadata("design:returntype",Promise)],UserController.prototype,"unfollow",null),UserController=tslib_1.__decorate([(0,common_1.Controller)(),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==user_service_1.UserService&&user_service_1.UserService)?_a:Object])],UserController),exports.UserController=UserController},7513:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b;Object.defineProperty(exports,"__esModule",{value:!0}),exports.UpdateUserDto=exports.CreateUserDto=void 0;const tslib_1=__webpack_require__(752),class_validator_1=__webpack_require__(5849);class CreateUserDto{}tslib_1.__decorate([(0,class_validator_1.IsString)({message:"Username must be a string!"}),(0,class_validator_1.IsDefined)({message:"Username is required!"}),(0,class_validator_1.MinLength)(5,{message:"Username must be at least 5 characters long!"}),tslib_1.__metadata("design:type",String)],CreateUserDto.prototype,"username",void 0),tslib_1.__decorate([(0,class_validator_1.IsString)({message:"Firstname must be a string!"}),(0,class_validator_1.IsDefined)({message:"Firstname is required!"}),tslib_1.__metadata("design:type",String)],CreateUserDto.prototype,"firstname",void 0),tslib_1.__decorate([(0,class_validator_1.IsString)({message:"Firstname must be a string!"}),(0,class_validator_1.IsDefined)({message:"Firstname is required!"}),tslib_1.__metadata("design:type",String)],CreateUserDto.prototype,"lastname",void 0),tslib_1.__decorate([(0,class_validator_1.IsEmail)({message:"Email must be a valid email!"}),(0,class_validator_1.IsString)({message:"Email must be a string!"}),(0,class_validator_1.IsDefined)({message:"Email is required!"}),tslib_1.__metadata("design:type",String)],CreateUserDto.prototype,"email",void 0),tslib_1.__decorate([(0,class_validator_1.Matches)(/^\d{4}[./-]\d{2}[./-]\d{2}$/,{message:"Date of birth must be a valid date! (YYYY-MM-DD)"}),(0,class_validator_1.IsDefined)({message:"Date of birth is required!"}),tslib_1.__metadata("design:type","function"==typeof(_a="undefined"!=typeof Date&&Date)?_a:Object)],CreateUserDto.prototype,"dateOfBirth",void 0),tslib_1.__decorate([(0,class_validator_1.IsString)({message:"Password must be a string!"}),(0,class_validator_1.IsDefined)({message:"Password is required!"}),(0,class_validator_1.MinLength)(8,{message:"Password must be at least 8 characters long!"}),tslib_1.__metadata("design:type",String)],CreateUserDto.prototype,"password",void 0),tslib_1.__decorate([(0,class_validator_1.IsString)({message:"UserImageUrl must be a string!"}),(0,class_validator_1.IsDefined)({message:"UserImageUrl is required!"}),tslib_1.__metadata("design:type",String)],CreateUserDto.prototype,"userImageUrl",void 0),exports.CreateUserDto=CreateUserDto;class UpdateUserDto{}tslib_1.__decorate([(0,class_validator_1.IsOptional)(),(0,class_validator_1.IsString)({message:"Username must be a string!"}),(0,class_validator_1.IsDefined)({message:"Username is required!"}),(0,class_validator_1.MinLength)(5,{message:"Username must be at least 5 characters long!"}),tslib_1.__metadata("design:type",String)],UpdateUserDto.prototype,"username",void 0),tslib_1.__decorate([(0,class_validator_1.IsOptional)(),(0,class_validator_1.IsString)({message:"Firstname must be a string!"}),(0,class_validator_1.IsDefined)({message:"Firstname is required!"}),tslib_1.__metadata("design:type",String)],UpdateUserDto.prototype,"firstname",void 0),tslib_1.__decorate([(0,class_validator_1.IsOptional)(),(0,class_validator_1.IsString)({message:"Firstname must be a string!"}),(0,class_validator_1.IsDefined)({message:"Firstname is required!"}),tslib_1.__metadata("design:type",String)],UpdateUserDto.prototype,"lastname",void 0),tslib_1.__decorate([(0,class_validator_1.IsOptional)(),(0,class_validator_1.IsEmail)({message:"Email must be a valid email!"}),(0,class_validator_1.IsString)({message:"Email must be a string!"}),(0,class_validator_1.IsDefined)({message:"Email is required!"}),tslib_1.__metadata("design:type",String)],UpdateUserDto.prototype,"email",void 0),tslib_1.__decorate([(0,class_validator_1.IsOptional)(),(0,class_validator_1.Matches)(/^\d{4}[./-]\d{2}[./-]\d{2}$/,{message:"Date of birth must be a valid date! (YYYY-MM-DD)"}),(0,class_validator_1.IsDefined)({message:"Date of birth is required!"}),tslib_1.__metadata("design:type","function"==typeof(_b="undefined"!=typeof Date&&Date)?_b:Object)],UpdateUserDto.prototype,"dateOfBirth",void 0),tslib_1.__decorate([(0,class_validator_1.IsOptional)(),(0,class_validator_1.IsString)({message:"Password must be a string!"}),(0,class_validator_1.IsDefined)({message:"Password is required!"}),(0,class_validator_1.MinLength)(8,{message:"Password must be at least 8 characters long!"}),tslib_1.__metadata("design:type",String)],UpdateUserDto.prototype,"password",void 0),tslib_1.__decorate([(0,class_validator_1.IsOptional)(),(0,class_validator_1.IsString)({message:"UserImageUrl must be a string!"}),(0,class_validator_1.IsDefined)({message:"UserImageUrl is required!"}),tslib_1.__metadata("design:type",String)],UpdateUserDto.prototype,"userImageUrl",void 0),exports.UpdateUserDto=UpdateUserDto},6642:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.UserModule=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),mongoose_1=__webpack_require__(1794),community_module_1=__webpack_require__(908),neo4j_module_1=__webpack_require__(7641),user_controller_1=__webpack_require__(5755),user_schema_1=__webpack_require__(8427),user_service_1=__webpack_require__(5680);let UserModule=class UserModule{};UserModule=tslib_1.__decorate([(0,common_1.Module)({imports:[neo4j_module_1.Neo4jModule.forRoot({scheme:"bolt",host:"127.0.0.1",port:7687,username:"neo4j",password:"neo"}),mongoose_1.MongooseModule.forFeature([{name:user_schema_1.User.name,schema:user_schema_1.UserSchema}]),(0,common_1.forwardRef)((()=>community_module_1.CommunityModule))],providers:[user_service_1.UserService],controllers:[user_controller_1.UserController],exports:[user_service_1.UserService]})],UserModule),exports.UserModule=UserModule},8427:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b;Object.defineProperty(exports,"__esModule",{value:!0}),exports.UserSchema=exports.User=void 0;const tslib_1=__webpack_require__(752),mongoose_1=__webpack_require__(1794),class_validator_1=__webpack_require__(5849);let User=class User{};tslib_1.__decorate([(0,class_validator_1.IsString)({message:"Username must be a string!"}),(0,class_validator_1.IsDefined)({message:"Username is required!"}),(0,class_validator_1.MinLength)(5,{message:"Username must be at least 5 characters long!"}),(0,mongoose_1.Prop)(),tslib_1.__metadata("design:type",String)],User.prototype,"username",void 0),tslib_1.__decorate([(0,class_validator_1.IsString)({message:"Firstname must be a string!"}),(0,class_validator_1.IsDefined)({message:"Firstname is required!"}),(0,mongoose_1.Prop)(),tslib_1.__metadata("design:type",String)],User.prototype,"firstname",void 0),tslib_1.__decorate([(0,class_validator_1.IsString)({message:"Lastname must be a string!"}),(0,class_validator_1.IsDefined)({message:"Lastname is required!"}),(0,mongoose_1.Prop)(),tslib_1.__metadata("design:type",String)],User.prototype,"lastname",void 0),tslib_1.__decorate([(0,class_validator_1.IsEmail)({message:"Email must be a valid email!"}),(0,class_validator_1.IsString)({message:"Email must be a string!"}),(0,class_validator_1.IsDefined)({message:"Email is required!"}),(0,mongoose_1.Prop)(),tslib_1.__metadata("design:type",String)],User.prototype,"email",void 0),tslib_1.__decorate([(0,class_validator_1.Matches)(/^\d{4}[./-]\d{2}[./-]\d{2}$/,{message:"Date of birth must be a valid date! (YYYY-MM-DD)"}),(0,class_validator_1.IsDefined)({message:"Date of birth is required!"}),(0,mongoose_1.Prop)(),tslib_1.__metadata("design:type","function"==typeof(_a="undefined"!=typeof Date&&Date)?_a:Object)],User.prototype,"dateOfBirth",void 0),tslib_1.__decorate([(0,class_validator_1.IsString)({message:"Password must be a string!"}),(0,class_validator_1.IsDefined)({message:"Password is required!"}),(0,class_validator_1.MinLength)(8,{message:"Password must be at least 8 characters long!"}),(0,mongoose_1.Prop)(),tslib_1.__metadata("design:type",String)],User.prototype,"password",void 0),tslib_1.__decorate([(0,class_validator_1.IsString)({message:"UserImageUrl must be a string!"}),(0,class_validator_1.IsDefined)({message:"UserImageUrl is required!"}),(0,mongoose_1.Prop)(),tslib_1.__metadata("design:type",String)],User.prototype,"userImageUrl",void 0),tslib_1.__decorate([(0,class_validator_1.IsDate)({message:"Creation date must be a date!"}),(0,mongoose_1.Prop)(),tslib_1.__metadata("design:type","function"==typeof(_b="undefined"!=typeof Date&&Date)?_b:Object)],User.prototype,"creationDate",void 0),tslib_1.__decorate([(0,class_validator_1.IsBoolean)({message:"isActive must be a boolean!"}),(0,mongoose_1.Prop)(),tslib_1.__metadata("design:type",Boolean)],User.prototype,"isActive",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)(),tslib_1.__metadata("design:type",Array)],User.prototype,"roles",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)({default:[],ref:"Community"}),tslib_1.__metadata("design:type",Array)],User.prototype,"joinedCommunities",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)({default:[],ref:"Community"}),tslib_1.__metadata("design:type",Array)],User.prototype,"createdCommunities",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)({default:[],ref:"User"}),tslib_1.__metadata("design:type",Array)],User.prototype,"following",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)({default:[],ref:"User"}),tslib_1.__metadata("design:type",Array)],User.prototype,"followers",void 0),User=tslib_1.__decorate([(0,mongoose_1.Schema)()],User),exports.User=User,exports.UserSchema=mongoose_1.SchemaFactory.createForClass(User)},5680:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b,_c,_d;Object.defineProperty(exports,"__esModule",{value:!0}),exports.UserService=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),mongoose_1=__webpack_require__(1794),bcrypt=__webpack_require__(8432),mongoose_2=__webpack_require__(1185),role_enum_1=__webpack_require__(1360),community_schema_1=__webpack_require__(637),community_service_1=__webpack_require__(8367),neo4j_service_1=__webpack_require__(857),validation_exception_1=__webpack_require__(4625),user_schema_1=__webpack_require__(8427);let UserService=class UserService{constructor(userModel,communityModel,communityService,neo4jService){this.userModel=userModel,this.communityModel=communityModel,this.communityService=communityService,this.neo4jService=neo4jService}findByUsernameOrEmail(username){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.userModel.findOne({$or:[{username},{email:username}]})}))}getById(_id){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.doesExist(_id),(yield this.userModel.aggregate([{$match:{_id:new mongoose_2.Types.ObjectId(_id)}},{$lookup:{from:"users",localField:"following",foreignField:"_id",as:"following"}},{$lookup:{from:"users",localField:"followers",foreignField:"_id",as:"followers"}},{$unset:["password","__v"]}]))[0]}))}getAll(){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.userModel.aggregate([{$lookup:{from:"users",localField:"following",foreignField:"_id",as:"following"}},{$lookup:{from:"users",localField:"followers",foreignField:"_id",as:"followers"}},{$unset:["password","__v"]}])}))}create(createUserDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){yield this.validate(createUserDto),createUserDto.dateOfBirth=new Date(createUserDto.dateOfBirth),createUserDto.dateOfBirth.setHours(createUserDto.dateOfBirth.getHours()+1);const mergedUser=Object.assign(Object.assign({},createUserDto),{creationDate:new Date,isActive:!0,roles:[role_enum_1.Role.User],password:yield bcrypt.hashSync(createUserDto.password,10)}),user=yield new this.userModel(mergedUser).save();return yield this.neo4jService.write(`\n      CREATE\n      (n:User {\n      id: '${user._id.toString()}',\n      username: '${user.username}', \n      dateOfBirth: '${user.dateOfBirth.toISOString()}'\n     })`,{}),user}))}update(updateUserId,user,req){return tslib_1.__awaiter(this,void 0,void 0,(function*(){yield this.doesExist(updateUserId);const currentUser=req.user;if((yield this.isMyData(updateUserId,currentUser.id))||currentUser.roles.includes(role_enum_1.Role.Admin))return yield this.validate(user,currentUser.id,updateUserId),user.dateOfBirth&&(user.dateOfBirth=new Date(user.dateOfBirth),user.dateOfBirth.setHours(user.dateOfBirth.getHours()+1)),user.password&&(user.password=yield bcrypt.hashSync(user.password,10)),yield this.communityService.updateCreator(updateUserId,Object.assign(Object.assign({},(yield this.userModel.findOne({_id:updateUserId})).toObject()),user)),this.userModel.findOneAndUpdate({_id:updateUserId},user,{new:!0});throw new validation_exception_1.ValidationException(["You cannot update other users!"])}))}follow(followUserId,req){return tslib_1.__awaiter(this,void 0,void 0,(function*(){if(yield this.doesExist(followUserId),yield this.isMyData(followUserId,req.user.id))throw new validation_exception_1.ValidationException(["You cannot follow yourself!"]);if((yield(yield this.userModel.find({$and:[{_id:req.user.id},{following:{$in:followUserId}}]})).length)>0)throw new validation_exception_1.ValidationException(["You already follow this person!"]);return[yield this.userModel.findOneAndUpdate({_id:req.user.id},{$push:{following:followUserId}},{new:!0}),yield this.userModel.findOneAndUpdate({_id:followUserId},{$push:{followers:req.user.id}},{new:!0})]}))}unfollow(followUserId,req){return tslib_1.__awaiter(this,void 0,void 0,(function*(){if(yield this.doesExist(followUserId),yield this.isMyData(followUserId,req.user.id))throw new validation_exception_1.ValidationException(["You cannot unfollow yourself!"]);if(0===(yield(yield this.userModel.find({$and:[{_id:req.user.id},{following:{$in:followUserId}}]})).length))throw new validation_exception_1.ValidationException(["You don't follow this person!"]);return[yield this.userModel.findOneAndUpdate({_id:req.user.id},{$pull:{following:followUserId}},{new:!0}),yield this.userModel.findOneAndUpdate({_id:followUserId},{$pull:{followers:req.user.id}},{new:!0})]}))}addJoinedCommunity(userId,communityId){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.doesExist(userId),yield this.userModel.findOneAndUpdate({_id:userId},{$push:{joinedCommunities:communityId}},{new:!0})}))}removeJoinedCommunity(userId,communityId){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.doesExist(userId),yield this.userModel.findOneAndUpdate({_id:userId},{$pull:{joinedCommunities:communityId}},{new:!0})}))}addCreatedCommunity(userId,communityId){var e_1,_a;return tslib_1.__awaiter(this,void 0,void 0,(function*(){yield this.doesExist(userId);const user=yield this.userModel.findOne({_id:userId});try{for(var _c,_b=tslib_1.__asyncValues(user.createdCommunities);!(_c=yield _b.next()).done;){const createdCommunityId=_c.value;yield this.communityModel.updateMany({_id:createdCommunityId,"createdBy._id":new mongoose_2.Types.ObjectId(userId)},{$push:{"createdBy.$[_id]createdCommunities":communityId}})}}catch(e_1_1){e_1={error:e_1_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&(yield _a.call(_b))}finally{if(e_1)throw e_1.error}}return yield this.userModel.findOneAndUpdate({_id:userId},{$push:{createdCommunities:communityId}},{new:!0})}))}removeCreatedCommunity(userId,communityId){var e_2,_a;return tslib_1.__awaiter(this,void 0,void 0,(function*(){yield this.doesExist(userId);const user=yield this.userModel.findOne({_id:userId});try{for(var _c,_b=tslib_1.__asyncValues(user.createdCommunities);!(_c=yield _b.next()).done;){const createdCommunityId=_c.value;yield this.communityModel.updateMany({_id:createdCommunityId,"createdBy._id":new mongoose_2.Types.ObjectId(userId)},{$pull:{"createdBy.$[_id]createdCommunities":communityId}})}}catch(e_2_1){e_2={error:e_2_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&(yield _a.call(_b))}finally{if(e_2)throw e_2.error}}return yield this.userModel.findOneAndUpdate({_id:userId},{$pull:{createdCommunities:communityId}},{new:!0})}))}validate(user,currentUserId,updateUserId){return tslib_1.__awaiter(this,void 0,void 0,(function*(){if((yield this.userModel.find({$or:[{username:user.username},{email:user.email}]})).length>0&&!(yield this.isMyData(currentUserId,updateUserId)))throw new common_1.HttpException("Username or email is already in use!",common_1.HttpStatus.BAD_REQUEST);if(new Date(user.dateOfBirth)>new Date)throw new common_1.HttpException("Date of birth cannot be in the future!",common_1.HttpStatus.BAD_REQUEST)}))}isMyData(currentUserId,targetUserId){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return new mongoose_2.Types.ObjectId(currentUserId).equals(new mongoose_2.Types.ObjectId(targetUserId))}))}doesExist(userId){return tslib_1.__awaiter(this,void 0,void 0,(function*(){if(!(yield this.userModel.findOne({_id:userId})))throw new common_1.HttpException(`User with id of ${userId} doesn't exist!`,common_1.HttpStatus.BAD_REQUEST)}))}};UserService=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__param(0,(0,mongoose_1.InjectModel)(user_schema_1.User.name)),tslib_1.__param(1,(0,mongoose_1.InjectModel)(community_schema_1.Community.name)),tslib_1.__param(2,(0,common_1.Inject)((0,common_1.forwardRef)((()=>community_service_1.CommunityService)))),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==mongoose_2.Model&&mongoose_2.Model)?_a:Object,"function"==typeof(_b=void 0!==mongoose_2.Model&&mongoose_2.Model)?_b:Object,"function"==typeof(_c=void 0!==community_service_1.CommunityService&&community_service_1.CommunityService)?_c:Object,"function"==typeof(_d=void 0!==neo4j_service_1.Neo4jService&&neo4j_service_1.Neo4jService)?_d:Object])],UserService),exports.UserService=UserService},6087:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.environment=void 0,exports.environment={production:!0,DATABASE_CONNECTION:"mongodb://127.0.0.1:27017/riddet",NEO4J_HOST:"localhost",NEO4J_PORT:7687,NEO4J_USERNAME:"neo4j",NEO4J_PASSWORD:"neo"}},6481:module=>{module.exports=require("@nestjs/common")},143:module=>{module.exports=require("@nestjs/core")},2064:module=>{module.exports=require("@nestjs/jwt")},1794:module=>{module.exports=require("@nestjs/mongoose")},4340:module=>{module.exports=require("@nestjs/passport")},8432:module=>{module.exports=require("bcryptjs")},5849:module=>{module.exports=require("class-validator")},8013:module=>{module.exports=require("mongodb")},1185:module=>{module.exports=require("mongoose")},3255:module=>{module.exports=require("neo4j-driver")},136:module=>{module.exports=require("passport-jwt")},7055:module=>{module.exports=require("passport-local")},752:module=>{module.exports=require("tslib")}},__webpack_module_cache__={};function __webpack_require__(moduleId){var cachedModule=__webpack_module_cache__[moduleId];if(void 0!==cachedModule)return cachedModule.exports;var module=__webpack_module_cache__[moduleId]={exports:{}};return __webpack_modules__[moduleId](module,module.exports,__webpack_require__),module.exports}var __webpack_exports__={};(()=>{var exports=__webpack_exports__;Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),core_1=__webpack_require__(143),app_module_1=__webpack_require__(8753),validation_exception_1=__webpack_require__(4625),validation_filter_1=__webpack_require__(8868);!function(){tslib_1.__awaiter(this,void 0,void 0,(function*(){const app=yield core_1.NestFactory.create(app_module_1.AppModule);app.setGlobalPrefix("api"),app.enableCors();const port=process.env.PORT||9e3;app.useGlobalFilters(new validation_filter_1.ValidationFilter),app.useGlobalPipes(new common_1.ValidationPipe({skipMissingProperties:!0,exceptionFactory:errors=>{const messages=errors.map((error=>`${error.property} has wrong value: ${error.value}, ${Object.values(error.constraints).join(", ")}`));return new validation_exception_1.ValidationException(messages)}})),yield app.listen(port),common_1.Logger.log(` Application is running on: http://localhost:${port}/api`)}))}()})();var __webpack_export_target__=exports;for(var i in __webpack_exports__)__webpack_export_target__[i]=__webpack_exports__[i];__webpack_exports__.__esModule&&Object.defineProperty(__webpack_export_target__,"__esModule",{value:!0})})();
//# sourceMappingURL=main.js.map